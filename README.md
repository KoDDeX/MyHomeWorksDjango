# Telegram-бот для уведомлений о новых заказах в барбершопе

В данном проекте реализован Telegram-бот, который автоматически уведомляет администратора о новых заказах, поступающих через сайт барбершопа "ЦирюльникЪ". Бот интегрирован с Django-приложением и работает полностью в автоматическом режиме, реагируя на события в базе данных.

## Основные функции бота

1. **Автоматические уведомления**: бот отправляет сообщения в Telegram при добавлении новых услуг к заказу (создании новой записи на консультацию).
2. **Информативные сообщения**: каждое уведомление содержит имя клиента, телефон, комментарий, список выбранных услуг, дату создания заказа, имя мастера, желаемую дату визита и прямую ссылку на заказ в админ-панели.
3. **Форматирование сообщений**: сообщения оформлены с помощью Markdown для лучшей читаемости в Telegram.
4. **Асинхронная отправка**: бот использует асинхронную библиотеку python-telegram-bot, что позволяет не блокировать основной поток Django-приложения.
5. **Гибкая интеграция**: бот реализован через Django signals (m2m_changed), что позволяет легко расширять и модифицировать логику уведомлений.
6. **Безопасность**: ключи доступа к Telegram-боту и идентификатор чата не хранятся в открытом виде в коде.
7. **Масштабируемость**: при необходимости можно добавить уведомления для других событий (например, новые отзывы, отмена заказа и т.д.).
8. **Логирование**: все попытки отправки сообщений логируются, что облегчает отладку и мониторинг работы бота.

## Как работает бот

- При создании или изменении заказа (Order) в Django, когда к заказу добавляются услуги (ManyToMany), срабатывает сигнал m2m_changed.
- Обработчик сигнала формирует подробное сообщение о заказе и вызывает функцию отправки сообщения в Telegram.
- Сообщение отправляется асинхронно, что не замедляет работу сайта.
- В сообщении присутствует ссылка на заказ в админ-панели, что позволяет быстро перейти к его обработке.

## Откуда берутся ключи и идентификаторы

- Ключ API Telegram-бота (`TELEGRAM_BOT_API_KEY`) и идентификатор пользователя или чата (`TELEGRAM_USER_ID`) хранятся в файле `.env` в корне проекта.
- Для загрузки переменных окружения используется библиотека `python-dotenv`.
- В файле `settings.py` значения ключей подгружаются через `os.getenv()` и становятся доступны во всём проекте.
- Ключи не хранятся в открытом виде в репозитории и не попадают под контроль версий (файл `.env` должен быть добавлен в `.gitignore`).

## Преимущества такого подхода

- **Безопасность**: секретные данные не попадают в публичный доступ.
- **Гибкость**: можно легко сменить ключи или идентификаторы без изменения кода.
- **Удобство**: все настройки хранятся централизованно и легко управляются.

## Пример содержимого .env (не добавляйте в репозиторий!)

```
TELEGRAM_BOT_API_KEY=ваш_ключ_бота
TELEGRAM_USER_ID=ваш_id_чата
```

## Итог

В результате интеграции Telegram-бота администратор всегда оперативно получает уведомления о новых заказах, что повышает скорость и качество обслуживания клиентов. Решение легко расширяется и поддерживает современные стандарты безопасности.
